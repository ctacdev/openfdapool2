### Production Container Setup ###

#### Background ####

The production setup is very similar to the development setup, except that docker-compose is not used. Since the target production environment is Amazon Elastic Beanstalk and Amazon provides it's own RDS (Relation Database Service), there is no need to include our own database container. We also need to do a few extra steps - modify the runtime command slightly to execute rails in the production environment mode, and precompile the static assets.

- Production environment uses Amazon RDS (mysql)
- Production environment is Amazon Linux
- Production deploy should be automatic


#### Setup Instructions ####

The production environment will make use of the default Dockerfile automatically:

    FROM library/ruby:2.2.2

    RUN apt-get update -qq && apt-get install -y build-essential

    # for nokogiri
    RUN apt-get install -y libxml2-dev libxslt1-dev

    # for a JS runtime
    RUN apt-get install -y nodejs

    # set app root
    ENV APP_HOME /openfda
    RUN mkdir $APP_HOME
    WORKDIR $APP_HOME

    # add gemfile and install gems
    ADD Gemfile* $APP_HOME/
    RUN bundle install

    # add all files
    ADD . $APP_HOME

    # precompile assets
    RUN bundle exec rake assets:precompile --trace RAILS_ENV=production

    # add assets
    ADD public $APP_HOME

    # tell amazon which port app uses
    EXPOSE 3000

    #run the app
    CMD ["foreman", "start", "-e", ".env.production", "web"]


The main differences here are the extra RUN command for asset pre-compilation, the addition of the EXPOSE command (a hint for Amazon for setting up an automatic nginx proxy 80->3000), and a production .env file containing the real production config information. This file is generated by our Jenkins CI server (an example can be found in the project root directory).
